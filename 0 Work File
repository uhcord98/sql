SELECT NPS.SURVEY_DT-EXTRACT(DAY FROM NPS.SURVEY_DT)+1 AS REPORT_MONTH,NPS.SURVEY_DT,ECHV.SUPER_NM_LVL1,ECHV.SUPER_NM_LVL2,CONCAT(ECHV.NM_LAST,' ,',ECHV.NM_FIRST) AS REP,CAST(SUM(CASEWHEN NPS.REP_EXPERIENCE_SCORE_SCALE5 = '5' THEN 1 ELSE 0END)AS FLOAT) AS NUMERATOR,SUM(1.0)  AS DENOMINATOR,CAST(NUMERATOR AS FLOAT)/CAST(DENOMINATOR AS FLOAT) AS RIS_SCORE,(NUMERATOR)/(DENOMINATOR) AS RIS_SCORE2FROM NTL_PRD_ALLVM.TOUCHPOINT_MDL_RESP_V NPSINNER JOIN NTL_PRD_ALLVM.EMPLOYEE_CONTRACTOR_HIST_V ECHV --SELECT * FROM NTL_PRD_ALLVM. EMPLOYEE_CONTRACTOR_HIST_VON NPS.REP_EID = ECHV.EIDAND SURVEY_DT BETWEEN ECHV.EFF_DT AND ECHV.EXP_DTWHERE NPS.NPS_CHANNEL = 'TELESALES'AND NPS.NPS_VEHICLE NOT IN ( 'S', 'W' ) --WILLRU1 UPDATED 2021-04-14  MY SURVEY HUB PILOT INTERIM QUARANTINE FOR SMS RESPONSES --<> 'WAND COALESCE(NPS.TRANS_TYPE_CD, '-') NOT IN ( 'VIS') /* Exclude Non-Transactional Surveys */AND NPS.SURVEY_TYPE_DESC NOT IN ( 'Verizon Experience Survey' ) /* Exclude VES Surveys */AND NPS.SURVEY_ID NOT LIKE '%_30thday%'/* Exclude Journey Surveys */AND NPS.SURVEY_DT >= 1220101GROUP BY 4,5,6,2,1,3ORDER BY 6 DESC,1,2
